<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Kajaki z Wujem – Wujoza Totalna 2025</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Bebas+Neue&display=swap" rel="stylesheet">
  <style>
    /* ... (tu wklej swój dotychczasowy CSS) ... */

    /* nowy styl dla progress bar */
    .progress-container {
      width: 80%;
      max-width: 400px;
      margin: 10px auto;
    }
    progress {
      width: 100%;
      height: 20px;
      appearance: none;
    }
    progress::-webkit-progress-bar {
      background: #eee;
      border-radius: 10px;
    }
    progress::-webkit-progress-value {
      background: #00bfff;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <!-- tło, nagłówki itp. jak dotąd -->
  <div class="content-box">
    <!-- ... cytaty itp. ... -->

    <form id="uploadForm" class="upload-form">
      <input type="file" id="fileInput" required>
      <div class="progress-container" style="display:none;">
        <progress id="uploadProgress" value="0" max="100"></progress>
      </div>
      <button type="submit">Wyślij film/zdjęcie</button>
      <p id="uploadMessage" style="display:none; color:green; font-weight:bold; margin-top:12px;">
        ✅ Wysłano! Możesz dodać kolejny plik.
      </p>
    </form>
  </div>

  <script>
    const SCRIPT_URL = 'TU_WKLEJ_SWÓJ_WEB_APP_URL_Z_APPS_SCRIPT';
    const form = document.getElementById('uploadForm');
    const fileInput = document.getElementById('fileInput');
    const progressBar = document.getElementById('uploadProgress');
    const progContainer = document.querySelector('.progress-container');
    const message = document.getElementById('uploadMessage');

    form.addEventListener('submit', e => {
      e.preventDefault();
      const file = fileInput.files[0];
      if (!file) return;

      // przygotowanie czytnika pliku
      const reader = new FileReader();
      reader.onload = () => {
        // base64 bez prefixu data:
        const base64 = reader.result.split(',')[1];
        const payload = {
          filename: file.name,
          mimeType: file.type,
          file: base64
        };

        // ustaw progress bar
        progContainer.style.display = 'block';
        progressBar.value = 0;

        // używamy XMLHttpRequest żeby mieć dostęp do upload.onprogress
        const xhr = new XMLHttpRequest();
        xhr.open('POST', SCRIPT_URL, true);
        xhr.setRequestHeader('Content-Type', 'application/json');

        xhr.upload.onprogress = evt => {
          if (evt.lengthComputable) {
            const percent = Math.round(evt.loaded / evt.total * 100);
            progressBar.value = percent;
          }
        };

        xhr.onload = () => {
          progContainer.style.display = 'none';
          if (xhr.status === 200) {
            const resp = JSON.parse(xhr.responseText);
            if (resp.status === 'OK') {
              message.style.display = 'block';
              setTimeout(() => message.style.display = 'none', 4000);
              fileInput.value = '';
            } else {
              alert('Błąd serwera: ' + resp.message);
            }
          } else {
            alert('Błąd sieci: ' + xhr.status);
          }
        };

        xhr.onerror = () => {
          progContainer.style.display = 'none';
          alert('Wystąpił błąd podczas wysyłania.');
        };

        xhr.send(JSON.stringify(payload));
      };

      reader.onerror = () => {
        alert('Nie udało się odczytać pliku.');
      };

      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
